<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>uxl-progress-indicator test</title>

    <script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../node_modules/wct-browser-legacy/browser.js"></script>

    <script type="module" src="../../src/uxl-progress-indicator.js"></script>
</head>

<body>

    <test-fixture id="defaultTestFixture">
        <template>
            <uxl-progress-indicator active></uxl-progress-indicator>
        </template>
    </test-fixture>

    <test-fixture id="textTestFixture">
        <template>
            <uxl-progress-indicator text="Cargando" active="true"></uxl-progress-indicator>
        </template>
    </test-fixture>

    <test-fixture id="spinnerTestFixture">
        <template>
            <uxl-progress-indicator text="Cargando" type="spinner" active="true"></uxl-progress-indicator>
        </template>
    </test-fixture>
    <test-fixture id="progressTestFixture">
        <template>
            <uxl-progress-indicator text="Cargando" type="progress" active="true"></uxl-progress-indicator>
        </template>
    </test-fixture>

    <test-fixture id="slotTestFixture">
        <template>
            <uxl-progress-indicator text="Cargando" type="progress" active="true">
                <p id="my-slot">slot text</p>
            </uxl-progress-indicator>
        </template>
    </test-fixture>

    <test-fixture id="positionTestFixture">
        <template>
            <uxl-progress-indicator text="Cargando" position="horizontal" active="true"></uxl-progress-indicator>
        </template>
    </test-fixture>

    <test-fixture id="fitTestFixture">
        <template>
            <uxl-progress-indicator fit active></uxl-progress-indicator>
        </template>
    </test-fixture>

    <test-fixture id="activeTestFixture">
        <template>
            <uxl-progress-indicator text="Cargando"></uxl-progress-indicator>
        </template>
    </test-fixture>

    <script type="module">
        const delay = (amount = 100) => new Promise(resolve => setTimeout(resolve, amount));
        const should = chai.should();

        suite('when use uxl-progress-indicator component', () => {
            test('instantiating the element with default properties works', async () => {
                const element = fixture('defaultTestFixture');
                await element.updateComplete;
                assert.equal(element.type, 'spinner');
                assert.equal(element.position, 'vertical');
                let spinner = element.shadowRoot.querySelector('paper-spinner-lite');
                should.exist(spinner);
            });

            test('displays text when pass a text property', async () => {
                const element = fixture('textTestFixture');
                await element.updateComplete;
                let divTitle = element.shadowRoot.querySelector('.progress-title');
                assert.equal(element.shadowRoot.querySelector('.progress-title').innerText, 'Cargando');
                assert.equal(element.text, 'Cargando');
            });

            test('displays the spinner when type property is set to "spinner"', async () => {
                const element = fixture('spinnerTestFixture');
                await element.updateComplete;
                let spinner = element.shadowRoot.querySelector('paper-spinner-lite');
                should.exist(spinner);
            });

            test('displays the progress-bar when type property is set to "progress"', async () => {
                const element = fixture('progressTestFixture');
                await element.updateComplete;
                let progress = element.shadowRoot.querySelector('paper-progress');
                should.exist(progress);
            });

            test('displays de slot content unless main content when slot is set', async () => {
                const element = fixture('slotTestFixture');
                await element.updateComplete;
                let slot = element.querySelector('#my-slot');
                should.exist(slot);
                let mainContainer = element.shadowRoot.getElementById('progress-container');
                should.exist(mainContainer);
            });

            test('applies classifier to container when position property is set', async () => {
                const element = fixture('positionTestFixture');
                await element.updateComplete;
                let mainContainer = element.shadowRoot.getElementById('progress-container');
                should.exist(mainContainer);
                assert.isTrue(mainContainer.classList.contains('horizontal'));
            });

            test('applies fit attribute to container when position is set', async () => {
                const element = fixture('fitTestFixture');
                await element.updateComplete;
                let mainContainer = element.shadowRoot.getElementById('progress-container');
                should.exist(mainContainer);
                assert.isTrue(mainContainer.classList.contains('fit'));
            });

            test('active property toggle display content', async () => {
                const element = fixture('activeTestFixture');
                await element.updateComplete;
                let mainContainer = element.shadowRoot.getElementById('progress-container');
                let slot = element.shadowRoot.getElementById('progress-slot');
                should.not.exist(mainContainer);
                should.exist(slot);
                element.active = true;
                await delay();
                mainContainer = element.shadowRoot.getElementById('progress-container');
                slot = element.shadowRoot.getElementById('progress-slot');
                should.exist(mainContainer);
                should.not.exist(slot);
                element.active = false;
                await delay();
                mainContainer = element.shadowRoot.getElementById('progress-container');
                slot = element.shadowRoot.getElementById('progress-slot');
                should.not.exist(mainContainer);
                should.exist(slot);
            });
        });
    </script>
</body>

</html>